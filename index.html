<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard Indicadores COP Rede - Equipe Nelson Soares</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:"Segoe UI",Tahoma,sans-serif;background:#0f1117;color:#e0e0e0;min-height:100vh}
.hdr{background:linear-gradient(135deg,#1a1a2e,#16213e);padding:18px 30px;display:flex;align-items:center;justify-content:space-between;border-bottom:3px solid #e50914}
.hdr h1{font-size:1.3em;color:#fff}
.hdr .inf{font-size:.8em;opacity:.7;color:#aaa}
.ctn{max-width:1500px;margin:0 auto;padding:15px}
.upload-section{background:#16213e;border-radius:12px;padding:25px;border:1px solid #2a2a4a;margin:15px 0}
.upload-section h2{color:#e50914;margin-bottom:15px;font-size:1.2em}
.upload-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:15px}
.upload-card{background:#1a1a2e;border:2px dashed #2a2a4a;border-radius:10px;padding:20px;text-align:center;transition:all .3s;cursor:pointer;position:relative}
.upload-card:hover{border-color:#e50914;background:#1e1e3a}
.upload-card.loaded{border-color:#00c853;border-style:solid;background:rgba(0,200,83,.05)}
.upload-card .icon{font-size:2em;margin-bottom:8px}
.upload-card .name{font-size:.9em;font-weight:600;color:#fff;margin-bottom:4px}
.upload-card .desc{font-size:.75em;color:#888}
.upload-card .status{font-size:.72em;margin-top:8px;padding:3px 10px;border-radius:10px;display:inline-block}
.upload-card .status.pending{background:rgba(255,193,7,.15);color:#ffc107}
.upload-card .status.ok{background:rgba(0,200,83,.15);color:#00c853}
.upload-card input[type=file]{display:none}
.btn-process{background:#e50914;color:#fff;border:none;padding:12px 30px;border-radius:8px;font-size:1em;cursor:pointer;margin-top:20px;font-weight:600;transition:all .3s;display:inline-flex;align-items:center;gap:8px}
.btn-process:hover{background:#ff1a25;transform:translateY(-2px)}
.btn-process:disabled{background:#444;cursor:not-allowed;transform:none}
.btn-clear{background:transparent;color:#aaa;border:1px solid #2a2a4a;padding:10px 20px;border-radius:8px;font-size:.85em;cursor:pointer;margin-top:20px;margin-left:10px;transition:all .3s}
.btn-clear:hover{border-color:#e50914;color:#e50914}
.progress-bar{height:4px;background:#2a2a4a;border-radius:2px;margin-top:15px;overflow:hidden;display:none}
.progress-bar.active{display:block}
.progress-bar .fill{height:100%;background:linear-gradient(90deg,#e50914,#ff6b6b);border-radius:2px;transition:width .3s;width:0}
.results{display:none}
.results.active{display:block}
.tabs{display:flex;gap:5px;margin:12px 0;flex-wrap:wrap}
.tab{padding:8px 18px;background:#16213e;border:1px solid #2a2a4a;border-radius:6px 6px 0 0;cursor:pointer;font-size:.82em;color:#aaa;transition:all .2s}
.tab.act{background:#e50914;color:#fff;border-color:#e50914}
.tab:hover{border-color:#e50914}
.panel{display:none}
.panel.act{display:block}
.kg{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:12px;margin:15px 0}
.kc{background:linear-gradient(145deg,#16213e,#1a1a2e);border-radius:10px;padding:15px;border:1px solid #2a2a4a;transition:transform .2s;position:relative;overflow:hidden}
.kc:hover{transform:translateY(-2px);border-color:#e50914}
.kc .lb{font-size:.7em;color:#999;text-transform:uppercase;letter-spacing:.5px;margin-bottom:4px}
.kc .vl{font-size:1.8em;font-weight:700;margin:4px 0}
.kc .mt{font-size:.7em;color:#666;margin-top:2px}
.kc .bar{height:3px;background:#2a2a4a;border-radius:2px;margin-top:8px;overflow:hidden}
.kc .bar-fill{height:100%;border-radius:2px;transition:width .5s}
.gr{color:#00c853}.yl{color:#ffc107}.rd{color:#ff5252}
.bg-gr{background:#00c853}.bg-yl{background:#ffc107}.bg-rd{background:#ff5252}
.sec{margin:20px 0}
.sec h2{font-size:1.15em;margin-bottom:10px;padding-bottom:6px;border-bottom:2px solid #e50914;display:inline-block;color:#fff}
table{width:100%;border-collapse:collapse;font-size:.78em;margin-top:8px}
th{background:#16213e;color:#aaa;padding:8px 10px;text-align:left;font-weight:600;text-transform:uppercase;font-size:.72em;letter-spacing:.5px;border-bottom:2px solid #e50914;position:sticky;top:0}
td{padding:7px 10px;border-bottom:1px solid #1e2a4a}
tr:hover td{background:rgba(229,9,20,.05)}
.badge{display:inline-block;padding:2px 8px;border-radius:10px;font-size:.72em;font-weight:600}
.badge-gr{background:rgba(0,200,83,.15);color:#00c853}
.badge-yl{background:rgba(255,193,7,.15);color:#ffc107}
.badge-rd{background:rgba(255,82,82,.15);color:#ff5252}
.note{background:#1a1a2e;border-left:3px solid #e50914;padding:10px 15px;margin:10px 0;font-size:.78em;color:#999;border-radius:0 6px 6px 0}
.tbl-wrap{overflow-x:auto;border-radius:8px;border:1px solid #2a2a4a}
.period-info{background:#16213e;padding:12px 20px;border-radius:8px;margin-bottom:15px;display:flex;justify-content:space-between;align-items:center;border:1px solid #2a2a4a;flex-wrap:wrap;gap:10px}
.period-info span{font-size:.85em;color:#aaa}
.period-info strong{color:#e50914}
.upload-info{background:#1a1a2e;border-radius:8px;padding:15px;margin:10px 0;font-size:.8em;color:#888;line-height:1.6}
.upload-info strong{color:#e50914}
.file-loaded-name{font-size:.7em;color:#00c853;margin-top:5px;word-break:break-all}
@media(max-width:768px){.kg{grid-template-columns:1fr 1fr}.hdr{flex-direction:column;gap:5px}.upload-grid{grid-template-columns:1fr}}
</style>
</head>
<body>
<div class="hdr">
<div><h1>‚ö° Dashboard Indicadores COP Rede</h1><div class="inf">Equipe Nelson Soares | COP REDE RJ | Leste - Rio e ES</div></div>
<div style="text-align:right"><div class="inf" id="periodo-display">üìÖ Aguardando upload dos dados...</div><div class="inf" id="update-display"></div></div>
</div>

<div class="ctn">
<div class="upload-section" id="upload-area">
<h2>üì§ Upload das Planilhas de Indicadores</h2>
<div class="upload-info">
Fa√ßa o upload das <strong>7 planilhas</strong> abaixo para processar os indicadores. As planilhas devem ser arquivos <strong>.xlsx</strong> ou <strong>.xls</strong>.<br>
Ap√≥s carregar todas as planilhas necess√°rias, clique em <strong>"Processar Dados"</strong> para gerar o dashboard.
</div>

<div class="upload-grid">
<div class="upload-card" onclick="document.getElementById('file-dpa').click()">
<div class="icon">üìä</div>
<div class="name">1. DPA - Ocupa√ß√£o</div>
<div class="desc">Planilha DPA Verint com dados de ocupa√ß√£o produtiva</div>
<div class="status pending" id="status-dpa">Aguardando</div>
<div class="file-loaded-name" id="fname-dpa"></div>
<input type="file" id="file-dpa" accept=".xlsx,.xls,.csv" onchange="handleFile(this,'dpa')">
</div>

<div class="upload-card" onclick="document.getElementById('file-chat').click()">
<div class="icon">üí¨</div>
<div class="name">2. Chat TOA</div>
<div class="desc">Planilha de intera√ß√£o Chat TOA (tempo de resposta 10min)</div>
<div class="status pending" id="status-chat">Aguardando</div>
<div class="file-loaded-name" id="fname-chat"></div>
<input type="file" id="file-chat" accept=".xlsx,.xls,.csv" onchange="handleFile(this,'chat')">
</div>

<div class="upload-card" onclick="document.getElementById('file-etit-ral').click()">
<div class="icon">‚è±Ô∏è</div>
<div class="name">3. ETIT por Evento RAL</div>
<div class="desc">Planilha ETIT tarefas direcionadas em at√© 30min (RAL)</div>
<div class="status pending" id="status-etit-ral">Aguardando</div>
<div class="file-loaded-name" id="fname-etit-ral"></div>
<input type="file" id="file-etit-ral" accept=".xlsx,.xls,.csv" onchange="handleFile(this,'etit-ral')">
</div>

<div class="upload-card" onclick="document.getElementById('file-etit-rec').click()">
<div class="icon">üîÑ</div>
<div class="name">4. ETIT por Evento REC</div>
<div class="desc">Planilha ETIT tarefas direcionadas em at√© 30min (REC)</div>
<div class="status pending" id="status-etit-rec">Aguardando</div>
<div class="file-loaded-name" id="fname-etit-rec"></div>
<input type="file" id="file-etit-rec" accept=".xlsx,.xls,.csv" onchange="handleFile(this,'etit-rec')">
</div>

<div class="upload-card" onclick="document.getElementById('file-outage-gpon').click()">
<div class="icon">üì°</div>
<div class="name">5. ETIT Outage Sem Sinal GPON</div>
<div class="desc">Planilha de outages GPON - Volume DP / Volume Total</div>
<div class="status pending" id="status-outage-gpon">Aguardando</div>
<div class="file-loaded-name" id="fname-outage-gpon"></div>
<input type="file" id="file-outage-gpon" accept=".xlsx,.xls,.csv" onchange="handleFile(this,'outage-gpon')">
</div>

<div class="upload-card" onclick="document.getElementById('file-log-reprog').click()">
<div class="icon">üìã</div>
<div class="name">6. Log Outage Reprog. GPON</div>
<div class="desc">Planilha de outages reprogramados sem sinal GPON</div>
<div class="status pending" id="status-log-reprog">Aguardando</div>
<div class="file-loaded-name" id="fname-log-reprog"></div>
<input type="file" id="file-log-reprog" accept=".xlsx,.xls,.csv" onchange="handleFile(this,'log-reprog')">
</div>

<div class="upload-card" onclick="document.getElementById('file-analitico').click()">
<div class="icon">üìà</div>
<div class="name">7. Anal√≠tico Indicadores TOA</div>
<div class="desc">Planilha anal√≠tica completa com dados individuais por analista</div>
<div class="status pending" id="status-analitico">Aguardando</div>
<div class="file-loaded-name" id="fname-analitico"></div>
<input type="file" id="file-analitico" accept=".xlsx,.xls,.csv" onchange="handleFile(this,'analitico')">
</div>
</div>

<div class="progress-bar" id="progress"><div class="fill" id="progress-fill"></div></div>

<div style="margin-top:20px;display:flex;align-items:center;flex-wrap:wrap;gap:10px">
<button class="btn-process" id="btn-process" onclick="processarDados()" disabled>üöÄ Processar Dados</button>
<button class="btn-clear" onclick="limparTudo()">üóëÔ∏è Limpar Tudo</button>
<span id="upload-count" style="font-size:.8em;color:#888;margin-left:10px">0 de 7 planilhas carregadas</span>
</div>
</div>

<div class="results" id="results-area">
<div class="period-info">
<span>üìä <strong>M√™s de Refer√™ncia:</strong> <span id="ref-month">-</span></span>
<span>üîÑ Dados processados em: <span id="process-date">-</span></span>
<span><button class="btn-clear" onclick="voltarUpload()">üì§ Novo Upload</button></span>
</div>

<div class="tabs" id="main-tabs">
<div class="tab act" onclick="showPanel('cons',this)">Consolidado</div>
<div class="tab" onclick="showPanel('emp',this)">Empresarial (13)</div>
<div class="tab" onclick="showPanel('res',this)">Residencial (8)</div>
<div class="tab" onclick="showPanel('metas',this)">Metas & Gloss√°rio</div>
</div>

<div id="cons" class="panel act"></div>
<div id="emp" class="panel"></div>
<div id="res" class="panel"></div>
<div id="metas" class="panel"></div>
</div>
</div>
<script>
// ============================================
// CONFIGURACOES E CONSTANTES
// ============================================
const METAS = {
  'DPA - Ocupa√ß√£o': {meta:90,dir:'up'},
  'Chat TOA': {meta:75,dir:'up'},
  'ETIT por Evento RAL': {meta:90,dir:'up'},
  'ETIT por Evento REC': {meta:90,dir:'up'},
  'ETIT Outage Sem Sinal (GPON)': {meta:90,dir:'up'},
  'Log Outage Reprog. GPON': {meta:10,dir:'down'},
  'ETIT Outage Res. Sem Sinal': {meta:90,dir:'up'},
  'ETIT Outage Res. Degrada√ß√£o': {meta:90,dir:'up'},
  'Tempo Valid. Formul√°rio': {meta:80,dir:'down'},
  'Tarefas Canceladas': {meta:15,dir:'up'},
  'Fechamento TOA x SIR': {meta:80,dir:'up'}
};

const EMPRESARIAL = [
  {login:'N6088107',nome:'LEANDRO GON√áALVES DE CARVALHO'},
  {login:'N5619600',nome:'BRUNO COSTA BUCARD'},
  {login:'N0189105',nome:'IGOR MARCELINO DE MARINS'},
  {login:'N5737414',nome:'SANDRO DA SILVA CARVALHO'},
  {login:'N5713690',nome:'GABRIELA TAVARES DA SILVA'},
  {login:'N5802257',nome:'MAGNO FERRAREZ DE MORAIS'},
  {login:'F201714',nome:'FERNANDA MESQUITA DE FREITAS'},
  {login:'N6173055',nome:'JEFFERSON LUIS GON√áALVES COITINHO'},
  {login:'N0125317',nome:'ROBERTO SILVA DO NASCIMENTO'},
  {login:'F218860',nome:'ALDENES MARQUES IDALINO DA SILVA'},
  {login:'N5819183',nome:'RODRIGO PIRES BERNARDINO'},
  {login:'N5926003',nome:'SUELLEN HERNANDEZ DA SILVA'},
  {login:'N5932064',nome:'MONICA DA SILVA RODRIGUES'}
];

const RESIDENCIAL = [
  {login:'N0238475',nome:'MARLEY MARQUES RIBEIRO'},
  {login:'N5923221',nome:'KELLY PINHEIRO LIRA'},
  {login:'N5772086',nome:'THIAGO PEREIRA DA SILVA'},
  {login:'N0239871',nome:'LEONARDO FERREIRA LIMA DE ALMEIDA'},
  {login:'N5577565',nome:'MARISTELLA MARCIA DOS SANTOS'},
  {login:'N5972428',nome:'CRISTIANE HERMOGENES DA SILVA'},
  {login:'N4014011',nome:'ALAN MARINHO DIAS'},
  {login:'F106664',nome:'RAISSA LIMA DE OLIVEIRA'}
];

const INDICADORES = [
  'DPA - Ocupa√ß√£o','Chat TOA','ETIT por Evento RAL','ETIT por Evento REC',
  'ETIT Outage Sem Sinal (GPON)','Log Outage Reprog. GPON','ETIT Outage Res. Sem Sinal',
  'ETIT Outage Res. Degrada√ß√£o','Tempo Valid. Formul√°rio','Tarefas Canceladas','Fechamento TOA x SIR'
];

const TODOS_ANALISTAS = [...EMPRESARIAL, ...RESIDENCIAL];
const allLogins = TODOS_ANALISTAS.map(a => a.login.toUpperCase());

// Estado do upload
const uploadedFiles = {};
const parsedData = {};

// ============================================
// FUNCOES DE UPLOAD E PARSE
// ============================================
function handleFile(input, key) {
  const file = input.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = function(e) {
    try {
      const data = new Uint8Array(e.target.result);
      const workbook = XLSX.read(data, {type: "array"});
      const firstSheet = workbook.SheetNames[0];
      const worksheet = workbook.Sheets[firstSheet];
      const jsonData = XLSX.utils.sheet_to_json(worksheet, {defval: ""});
      const allSheets = {};
      workbook.SheetNames.forEach(function(name) {
        allSheets[name] = XLSX.utils.sheet_to_json(workbook.Sheets[name], {defval: ""});
      });
      parsedData[key] = {sheets: allSheets, mainData: jsonData, sheetNames: workbook.SheetNames, fileName: file.name};
      uploadedFiles[key] = true;
      
      // Log for debugging
      console.log("Arquivo carregado:", key);
      console.log("Nome:", file.name);
      console.log("Abas:", workbook.SheetNames);
      console.log("Colunas:", Object.keys(jsonData[0] || {}));
      console.log("Primeiras linhas:", jsonData.slice(0, 3));
      
      document.getElementById("status-" + key).textContent = "‚úî Carregado (" + jsonData.length + " linhas)";
      document.getElementById("status-" + key).className = "status ok";
      document.getElementById("fname-" + key).textContent = file.name;
      input.closest(".upload-card").classList.add("loaded");
      updateUploadCount();
    } catch(err) {
      alert("Erro ao ler arquivo: " + err.message);
      console.error(err);
    }
  };
  reader.readAsArrayBuffer(file);
}

function updateUploadCount() {
  const count = Object.keys(uploadedFiles).length;
  document.getElementById("upload-count").textContent = count + " de 7 planilhas carregadas";
  document.getElementById("btn-process").disabled = count === 0;
}

function limparTudo() {
  Object.keys(uploadedFiles).forEach(function(k) { delete uploadedFiles[k]; });
  Object.keys(parsedData).forEach(function(k) { delete parsedData[k]; });
  document.querySelectorAll(".upload-card").forEach(function(c) {
    c.classList.remove("loaded");
    c.querySelector(".status").textContent = "Aguardando";
    c.querySelector(".status").className = "status pending";
    var fn = c.querySelector(".file-loaded-name");
    if(fn) fn.textContent = "";
    var inp = c.querySelector("input[type=file]");
    if(inp) inp.value = "";
  });
  updateUploadCount();
  document.getElementById("results-area").classList.remove("active");
  document.getElementById("upload-area").style.display = "block";
}

function voltarUpload() {
  document.getElementById("results-area").classList.remove("active");
  document.getElementById("upload-area").style.display = "block";
}

// ============================================
// FUNCOES DE PROCESSAMENTO
// ============================================
function findColumnByKeywords(headers, keywords) {
  if (!headers || !headers.length) return null;
  for (var i = 0; i < headers.length; i++) {
    var h = String(headers[i]).toUpperCase().trim();
    for (var j = 0; j < keywords.length; j++) {
      if (h.indexOf(keywords[j].toUpperCase()) !== -1) return headers[i];
    }
  }
  return null;
}

function findLoginColumn(headers) {
  var col = findColumnByKeywords(headers, ["LOGIN","MATRICULA","MATR√çCULA","RE","REGISTRO","USUARIO","USU√ÅRIO","AGENT","COLABORADOR ID","TECH ID"]);
  if (col) return col;
  
  // Se n√£o encontrou por keywords, procura coluna com texto (n√£o num√©rica, n√£o vazia)
  for (var i = 0; i < headers.length; i++) {
    var h = headers[i];
    if (h.indexOf("__EMPTY") !== -1 || h.toUpperCase().indexOf("PERCENTUAL") !== -1 || h.toUpperCase().indexOf("%") !== -1) continue;
    // Essa coluna poderia ser texto com nomes
    return h;
  }
  return null;
}

function findNameColumn(headers) {
  return findColumnByKeywords(headers, ["NOME","ANALISTA","COLABORADOR","FUNCIONARIO","FUNCION√ÅRIO","AGENT NAME","TECH NAME"]);
}

function findValueColumn(headers, sheetData, extraKeywords) {
  var kw = ["PERCENTUAL","%","VALOR","RESULTADO","TAXA","RATE","INDICADOR","ATINGIMENTO","PERFORMANCE","OCUPA√á√ÉO","OCUPACAO"];
  if (extraKeywords) kw = extraKeywords.concat(kw);
  var col = findColumnByKeywords(headers, kw);
  console.log("findValueColumn - keywords:", kw, "found:", col);
  if (col) return col;
  
  // Se n√£o encontrou, tenta procurar por qualquer coluna com n√∫meros entre 0-100
  console.log("Procurando por colunas num√©ricas em", headers.length, "colunas");
  for (var i = 0; i < headers.length; i++) {
    if (headers[i].toUpperCase().indexOf("TEXTO") !== -1 || headers[i].toUpperCase().indexOf("OBS") !== -1) continue;
    var vals = [];
    for (var j = 0; j < Math.min(sheetData.length, 10); j++) {
      var num = parseFloat(sheetData[j][headers[i]]);
      if (!isNaN(num) && num > 0 && num <= 100) vals.push(num);
    }
    if (vals.length > 3) {
      console.log("Encontrada coluna num√©rica:", headers[i], "com", vals.length, "valores");
      return headers[i];
    }
  }
  console.log("Nenhuma coluna num√©rica encontrada");
  return null;
}

function extractIndicatorData(sheetData, indicatorKeywords) {
  if (!sheetData || !sheetData.length) return {consolidated: null, byAnalyst: {}};
  
  // IMPORTANTE: A aba pode ter linhas vazias no in√≠cio, precisa encontrar o cabe√ßalho real
  var startRow = 0;
  for (var si = 0; si < sheetData.length; si++) {
    var row = sheetData[si];
    var hasData = false;
    for (var key in row) {
      var val = row[key];
      if (val !== null && val !== undefined && String(val).trim().length > 0) {
        hasData = true;
        break;
      }
    }
    if (hasData) {
      startRow = si;
      break;
    }
  }
  
  console.log("Primeira linha com dados:", startRow, sheetData[startRow]);
  
  var actualData = sheetData.slice(startRow === 0 ? 0 : startRow + 1);
  if (actualData.length === 0) {
    console.log("Nenhum dado encontrado ap√≥s skip de linhas vazias");
    return {consolidated: null, byAnalyst: {}};
  }
  
  var headers = Object.keys(actualData[0]);
  console.log("extractIndicatorData - Total headers:", headers.length);
  console.log("Todos os headers:", headers);
  
  // LOG: Mostra amostra de dados para DEBUG
  for (var logH = 0; logH < headers.length; logH++) {
    var h = headers[logH];
    var sample = [];
    for (var logR = 0; logR < Math.min(3, actualData.length); logR++) {
      sample.push(actualData[logR][h]);
    }
    console.log("  Col", logH, "(" + h + "):", sample);
  }
  
  // Primeiro, acha coluna de VALOR (percentuais 0-100)
  var valueCol = findValueColumn(headers, actualData, indicatorKeywords);
  console.log("ValueCol encontrada:", valueCol);
  
  // Depois, acha coluna de LOGIN (que n√£o seja valueCol e tenha texto)
  var loginCol = null;
  if (valueCol) {
    // Procura coluna com texto que n√£o seja a coluna de valor
    for (var i = 0; i < headers.length; i++) {
      var h = headers[i];
      // Pula colunas vazias e a coluna de valor (E colunas que parecem valores duplicados)
      if (h.indexOf("__EMPTY") !== -1 || h === valueCol) continue;
      if (h.indexOf(valueCol) !== -1 && h !== valueCol) continue; // Pula colunas duplicadas da coluna de valor
      
      // Verifica se essa coluna tem texto (poss√≠veis nomes/logins)
      var hasText = false;
      var hasNumbers = true;
      for (var j = 0; j < Math.min(actualData.length, 5); j++) {
        var val = actualData[j][h];
        if (!val || String(val).trim().length === 0) continue;
        
        var isNum = !isNaN(parseFloat(val));
        var isText = String(val).trim().length > 0 && !isNum;
        
        if (isText) hasText = true;
        if (!isNum) hasNumbers = false;
      }
      
      if (hasText && !hasNumbers) {
        loginCol = h;
        console.log("LoginCol encontrada (por texto):", loginCol);
        break;
      }
    }
  }
  
  // Fallback: usa a fun√ß√£o padr√£o se n√£o encontrou
  if (!loginCol) {
    loginCol = findLoginColumn(headers);
    console.log("LoginCol encontrada (padr√£o):", loginCol);
  }
  
  console.log("extractIndicatorData - Headers:", headers.length, "LoginCol:", loginCol, "ValueCol:", valueCol);
  
  var result = {consolidated: null, byAnalyst: {}};
  var allValues = [];
  var analystValues = [];
  
  if (actualData.length && valueCol) {
    console.log("Processando", actualData.length, "linhas com ValueCol:", valueCol, "LoginCol:", loginCol);
    
    actualData.forEach(function(row, rowIndex) {
      var rawVal = row[valueCol];
      var val = parseFloat(rawVal);
      
      // Skip invalid values
      if (isNaN(val) || val < 0) return;
      
      // Normalize value to 0-100 range
      if (val > 100) val = val / 100;
      if (val > 1) val = val; // Already in 0-100 range
      else if (val > 0 && val <= 1) val = val * 100; // 0-1 range, convert to 0-100
      
      val = Math.round(val * 100) / 100;
      
      var login = "";
      if (loginCol) {
        login = String(row[loginCol] || "").toUpperCase().trim();
        // Remove spaces and special characters from login for matching
        login = login.replace(/\s+/g, "");
      }
      
      // Check if login is in our analysts list
      var isKnownAnalyst = false;
      if (login && allLogins.length > 0) {
        for (var i = 0; i < allLogins.length; i++) {
          var cleanLogin = allLogins[i].replace(/\s+/g, "");
          if (cleanLogin === login || allLogins[i] === login) {
            login = allLogins[i]; // Use the original login from our list
            isKnownAnalyst = true;
            break;
          }
        }
      }
      
      if (login && isKnownAnalyst) {
        // For analysts with per-row data, use average if multiple entries
        if (!result.byAnalyst[login]) {
          result.byAnalyst[login] = [];
        }
        result.byAnalyst[login].push(val);
        allValues.push(val);
        analystValues.push(val);
      } else if (!loginCol) {
        // No login column - treat as consolidated data
        allValues.push(val);
      }
    });
  }
  
  // Calculate averages for each analyst
  Object.keys(result.byAnalyst).forEach(function(login) {
    var values = result.byAnalyst[login];
    if (values.length > 0) {
      result.byAnalyst[login] = Math.round((values.reduce(function(a,b){return a+b;},0) / values.length) * 100) / 100;
    }
  });
  
  // Calculate consolidated value - prefer analyst average if available, otherwise all values
  if (analystValues.length > 0) {
    result.consolidated = Math.round((analystValues.reduce(function(a,b){return a+b;},0) / analystValues.length) * 100) / 100;
  } else if (allValues.length > 0) {
    result.consolidated = Math.round((allValues.reduce(function(a,b){return a+b;},0) / allValues.length) * 100) / 100;
  }
  
  console.log("extractIndicatorData - Result:", result);
  return result;
}

function processarDados() {
  var progress = document.getElementById("progress");
  var fill = document.getElementById("progress-fill");
  progress.classList.add("active");
  fill.style.width = "10%";

  setTimeout(function() {
    fill.style.width = "30%";

    console.log("=== INICIANDO PROCESSAMENTO ===");
    console.log("Arquivos carregados:", Object.keys(parsedData));

    // Initialize data structures
    var consolidadoEmp = {};
    var consolidadoRes = {};
    var empAnalistas = {};
    var resAnalistas = {};

    EMPRESARIAL.forEach(function(a) {
      empAnalistas[a.login] = {};
      INDICADORES.forEach(function(ind) { empAnalistas[a.login][ind] = null; });
    });
    RESIDENCIAL.forEach(function(a) {
      resAnalistas[a.login] = {};
      INDICADORES.forEach(function(ind) { resAnalistas[a.login][ind] = null; });
    });
    INDICADORES.forEach(function(ind) { consolidadoEmp[ind] = null; consolidadoRes[ind] = null; });

    // Map file keys to indicators
    var fileIndicatorMap = {
      'dpa': ['DPA - Ocupa√ß√£o'],
      'chat': ['Chat TOA'],
      'etit-ral': ['ETIT por Evento RAL'],
      'etit-rec': ['ETIT por Evento REC'],
      'outage-gpon': ['ETIT Outage Sem Sinal (GPON)'],
      'log-reprog': ['Log Outage Reprog. GPON'],
      'analitico': INDICADORES
    };

    // Process each uploaded file
    Object.keys(parsedData).forEach(function(key) {
      console.log("\n--- Processando arquivo:", key, "---");
      var pd = parsedData[key];
      var indicators = fileIndicatorMap[key] || [];
      console.log("Indicadores esperados:", indicators);
      console.log("Dados:", pd.mainData.length, "linhas");
      
      if (key === "analitico") {
        // For the analytics file, try to extract all indicators from multiple sheets or columns
        var mainData = pd.mainData;
        if (mainData.length > 0) {
          var headers = Object.keys(mainData[0]);
          var loginCol = findLoginColumn(headers);
          
          if (loginCol) {
            // Try to find columns matching each indicator
            INDICADORES.forEach(function(ind) {
              var searchTerms = ind.split(/[\s-]+/).filter(function(s){return s.length > 2;});
              var col = findColumnByKeywords(headers, searchTerms);
              if (!col) col = findColumnByKeywords(headers, [ind]);
              
              if (col) {
                var empVals = [];
                var resVals = [];
                mainData.forEach(function(row) {
                  var rawLogin = String(row[loginCol] || "").toUpperCase().trim();
                  var cleanLogin = rawLogin.replace(/\s+/g, "");
                  var val = parseFloat(row[col]);
                  if (isNaN(val)) return;
                  
                  // Normalize value to 0-100 range
                  if (val > 100) val = val / 100;
                  if (val < 0) return;
                  
                  val = Math.round(val * 100) / 100;
                  
                  // Find matching analyst from our list
                  var matchedAnalyst = null;
                  for (var i = 0; i < allLogins.length; i++) {
                    var cleanRef = allLogins[i].replace(/\s+/g, "");
                    if (cleanRef === cleanLogin || allLogins[i] === rawLogin) {
                      matchedAnalyst = allLogins[i];
                      break;
                    }
                  }
                  
                  if (matchedAnalyst) {
                    var isEmp = EMPRESARIAL.some(function(a){return a.login.toUpperCase()===matchedAnalyst;});
                    var isRes = RESIDENCIAL.some(function(a){return a.login.toUpperCase()===matchedAnalyst;});
                    
                    if (isEmp) {
                      empAnalistas[matchedAnalyst] = empAnalistas[matchedAnalyst] || {};
                      empAnalistas[matchedAnalyst][ind] = val;
                      empVals.push(val);
                    } else if (isRes) {
                      resAnalistas[matchedAnalyst] = resAnalistas[matchedAnalyst] || {};
                      resAnalistas[matchedAnalyst][ind] = val;
                      resVals.push(val);
                    }
                  }
                });
                if (empVals.length > 0) consolidadoEmp[ind] = Math.round((empVals.reduce(function(a,b){return a+b;},0)/empVals.length)*100)/100;
                if (resVals.length > 0) consolidadoRes[ind] = Math.round((resVals.reduce(function(a,b){return a+b;},0)/resVals.length)*100)/100;
              }
            });
          }
          
          // Also try each sheet for different indicators
          pd.sheetNames.forEach(function(sheetName) {
            var sheetData = pd.sheets[sheetName];
            if (!sheetData || !sheetData.length) return;
            INDICADORES.forEach(function(ind) {
              var terms = ind.split(/[\s-]+/).filter(function(s){return s.length > 2;});
              var nameMatch = terms.some(function(t){return sheetName.toUpperCase().indexOf(t.toUpperCase()) !== -1;});
              if (nameMatch) {
                var extracted = extractIndicatorData(sheetData, terms);
                if (extracted.consolidated !== null) {
                  if (consolidadoEmp[ind] === null) consolidadoEmp[ind] = extracted.consolidated;
                }
                Object.keys(extracted.byAnalyst).forEach(function(login) {
                  var isEmp = EMPRESARIAL.some(function(a){return a.login.toUpperCase()===login;});
                  var isRes = RESIDENCIAL.some(function(a){return a.login.toUpperCase()===login;});
                  if (isEmp && empAnalistas[login] && empAnalistas[login][ind] === null) empAnalistas[login][ind] = extracted.byAnalyst[login];
                  if (isRes && resAnalistas[login] && resAnalistas[login][ind] === null) resAnalistas[login][ind] = extracted.byAnalyst[login];
                });
              }
            });
          });
        }
      } else {
        // For individual indicator files
        indicators.forEach(function(ind) {
          var keywords = ind.split(/[\s-]+/).filter(function(s){return s.length > 2;});
          
          // Try main data first
          var extracted = extractIndicatorData(pd.mainData, keywords);
          console.log("Tentativa 1 - Main data - Indicador:", ind, "Extracted:", extracted);
          
          // If no data found, try alternate sheets
          if (extracted.consolidated === null && Object.keys(extracted.byAnalyst).length === 0 && pd.sheetNames.length > 1) {
            console.log("Sem dados na aba principal, tentando abas alternativas...");
            // Try sheets with "Analista" or "Analyst" in the name
            for (var si = 0; si < pd.sheetNames.length; si++) {
              var sheetName = pd.sheetNames[si];
              if (sheetName.toUpperCase().indexOf("ANALISTA") !== -1 || sheetName.toUpperCase().indexOf("ANALYST") !== -1) {
                console.log("Tentando aba:", sheetName);
                extracted = extractIndicatorData(pd.sheets[sheetName], keywords);
                console.log("Tentativa - Aba", sheetName, "- Indicador:", ind, ":", extracted);
                if (extracted.consolidated !== null || Object.keys(extracted.byAnalyst).length > 0) {
                  console.log("Dados encontrados na aba:", sheetName);
                  break;
                }
              }
            }
          }
          
          if (extracted.consolidated !== null) {
            consolidadoEmp[ind] = consolidadoEmp[ind] || extracted.consolidated;
            consolidadoRes[ind] = consolidadoRes[ind] || extracted.consolidated;
          }
          
          // If no consolidated but has analyst data, calculate from analysts
          if (extracted.consolidated === null && Object.keys(extracted.byAnalyst).length > 0) {
            var vals = [];
            Object.keys(extracted.byAnalyst).forEach(function(login) {
              vals.push(extracted.byAnalyst[login]);
            });
            if (vals.length > 0) {
              var avg = vals.reduce(function(a,b){return a+b;},0) / vals.length;
              extracted.consolidated = Math.round(avg * 100) / 100;
              consolidadoEmp[ind] = consolidadoEmp[ind] || extracted.consolidated;
              consolidadoRes[ind] = consolidadoRes[ind] || extracted.consolidated;
            }
          }
          
          Object.keys(extracted.byAnalyst).forEach(function(login) {
            var isEmp = EMPRESARIAL.some(function(a){return a.login.toUpperCase()===login;});
            var isRes = RESIDENCIAL.some(function(a){return a.login.toUpperCase()===login;});
            if (isEmp && empAnalistas[login]) empAnalistas[login][ind] = extracted.byAnalyst[login];
            if (isRes && resAnalistas[login]) resAnalistas[login][ind] = extracted.byAnalyst[login];
          });
        });
      }
    });

    fill.style.width = "60%";

    // Calculate consolidated (weighted average)
    var dadosConsolidado = {};
    INDICADORES.forEach(function(ind) {
      var e = consolidadoEmp[ind];
      var r = consolidadoRes[ind];
      if (e !== null && r !== null) dadosConsolidado[ind] = Math.round(((e * 13 + r * 8) / 21) * 100) / 100;
      else if (e !== null) dadosConsolidado[ind] = e;
      else if (r !== null) dadosConsolidado[ind] = r;
      else dadosConsolidado[ind] = null;
    });

    console.log("\n=== RESULTADOS FINAIS ===");
    console.log("Consolidado Empresarial:", consolidadoEmp);
    console.log("Consolidado Residencial:", consolidadoRes);
    console.log("Consolidado Total:", dadosConsolidado);

    fill.style.width = "80%";

    // Render results
    var now = new Date();
    var monthNames = ["Janeiro","Fevereiro","Mar√ßo","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"];
    document.getElementById("ref-month").textContent = monthNames[now.getMonth()] + "/" + now.getFullYear();
    document.getElementById("process-date").textContent = now.toLocaleDateString("pt-BR") + " " + now.toLocaleTimeString("pt-BR");
    document.getElementById("periodo-display").textContent = "üìÖ Per√≠odo: " + monthNames[now.getMonth()] + "/" + now.getFullYear();
    document.getElementById("update-display").textContent = "Processado: " + now.toLocaleDateString("pt-BR");

    document.getElementById("cons").innerHTML = buildConsolidado(dadosConsolidado, consolidadoEmp, consolidadoRes);
    document.getElementById("emp").innerHTML = buildSector("Empresarial", EMPRESARIAL, consolidadoEmp, empAnalistas);
    document.getElementById("res").innerHTML = buildSector("Residencial", RESIDENCIAL, consolidadoRes, resAnalistas);
    document.getElementById("metas").innerHTML = buildMetas();

    fill.style.width = "100%";

    setTimeout(function() {
      document.getElementById("upload-area").style.display = "none";
      document.getElementById("results-area").classList.add("active");
      progress.classList.remove("active");
      fill.style.width = "0";
    }, 500);
  }, 200);
}

// ============================================
// FUNCOES DE STATUS E RENDER
// ============================================
function getStatus(valor, indicador) {
  var m = METAS[indicador];
  if (!m || valor === null || valor === undefined || valor === "-") return {cls:"yl",badge:"badge-yl",text:"N/D"};
  var v = parseFloat(valor);
  if (isNaN(v)) return {cls:"yl",badge:"badge-yl",text:"N/D"};
  if (m.dir === "up") {
    if (v >= m.meta) return {cls:"gr",badge:"badge-gr",text:"‚úî Atingido"};
    if (v >= m.meta * 0.9) return {cls:"yl",badge:"badge-yl",text:"‚ö† Aten√ß√£o"};
    return {cls:"rd",badge:"badge-rd",text:"‚úñ Abaixo"};
  } else {
    if (v <= m.meta) return {cls:"gr",badge:"badge-gr",text:"‚úî Atingido"};
    if (v <= m.meta * 1.1) return {cls:"yl",badge:"badge-yl",text:"‚ö† Aten√ß√£o"};
    return {cls:"rd",badge:"badge-rd",text:"‚úñ Abaixo"};
  }
}

function pct(v, indicador) {
  var m = METAS[indicador];
  if (!m || v === null || v === "-") return 0;
  var val = parseFloat(v);
  if (isNaN(val)) return 0;
  if (m.dir === "up") return Math.min(100, (val / m.meta) * 100);
  return Math.min(100, (m.meta / Math.max(val, 0.1)) * 100);
}

function buildKPICards(data) {
  var html = '<div class="kg">';
  INDICADORES.forEach(function(ind) {
    var val = data[ind];
    var st = getStatus(val, ind);
    var m = METAS[ind];
    var displayVal = (val !== null && val !== undefined && val !== "-") ? val + "%" : "Aguardando dados";
    var pctVal = pct(val, ind);
    var dirLabel = m.dir === "up" ? "‚Üë Meta: ‚â•" + m.meta + "%" : "‚Üì Meta: ‚â§" + m.meta + "%";
    html += '<div class="kc"><div class="lb">' + ind + '</div>';
    html += '<div class="vl ' + st.cls + '">' + displayVal + '</div>';
    html += '<div class="mt">' + dirLabel + ' | <span class="' + st.badge + ' badge">' + st.text + '</span></div>';
    html += '<div class="bar"><div class="bar-fill bg-' + st.cls + '" style="width:' + pctVal + '%"></div></div>';
    html += '</div>';
  });
  html += '</div>';
  return html;
}

function buildAnalystTable(analysts, sectorData) {
  var html = '<div class="tbl-wrap"><table><thead><tr><th>Login</th><th>Analista</th>';
  INDICADORES.forEach(function(ind) { html += "<th>" + ind + "</th>"; });
  html += '<th>Status</th></tr></thead><tbody>';
  analysts.forEach(function(a) {
    var d = sectorData[a.login] || {};
    var atingidos = 0;
    var total = 0;
    html += '<tr><td style="font-family:monospace;font-size:.75em">' + a.login + '</td><td style="white-space:nowrap">' + a.nome + '</td>';
    INDICADORES.forEach(function(ind) {
      var v = d[ind];
      var st = getStatus(v, ind);
      var display = (v !== null && v !== undefined && v !== "-") ? v + "%" : "-";
      if (v !== null && v !== undefined && v !== "-") { total++; if (st.cls === "gr") atingidos++; }
      html += '<td class="' + st.cls + '">' + display + '</td>';
    });
    var statusPct = total > 0 ? Math.round((atingidos/total)*100) : 0;
    html += '<td><span class="badge ' + (statusPct >= 80 ? "badge-gr" : statusPct >= 60 ? "badge-yl" : "badge-rd") + '">' + atingidos + "/" + total + '</span></td>';
    html += "</tr>";
  });
  html += '</tbody></table></div>';
  return html;
}

function buildConsolidado(dadosConsolidado, consolidadoEmp, consolidadoRes) {
  var h = '<div class="sec"><h2>üìä Vis√£o Consolidada</h2>';
  var filesInfo = Object.keys(parsedData).map(function(k){ return parsedData[k].fileName; }).join(", ");
  h += '<div class="note">‚ÑπÔ∏è Dados processados a partir das planilhas: <strong>' + filesInfo + '</strong></div>';
  h += buildKPICards(dadosConsolidado);
  h += '</div>';
  h += '<div class="sec"><h2>Empresarial (Grupo)</h2>';
  h += buildKPICards(consolidadoEmp);
  h += '</div>';
  h += '<div class="sec"><h2>Residencial (Grupo)</h2>';
  h += buildKPICards(consolidadoRes);
  h += '</div>';
  h += '<div class="sec"><h2>üìã Resumo Comparativo</h2>';
  h += '<div class="tbl-wrap"><table><thead><tr><th>Indicador</th><th>Meta</th><th>Dire√ß√£o</th><th>Empresarial</th><th>Residencial</th><th>Consolidado</th></tr></thead><tbody>';
  INDICADORES.forEach(function(ind) {
    var m = METAS[ind];
    var eVal = consolidadoEmp[ind];
    var rVal = consolidadoRes[ind];
    var cVal = dadosConsolidado[ind];
    var eSt = getStatus(eVal, ind);
    var rSt = getStatus(rVal, ind);
    var cSt = getStatus(cVal, ind);
    h += '<tr><td><strong>' + ind + '</strong></td>';
    h += "<td>" + m.meta + "%</td>";
    h += "<td>" + (m.dir==="up"?"‚Üë Bom p/ +":"‚Üì Bom p/ -") + "</td>";
    h += '<td class="' + eSt.cls + '">' + (eVal !== null ? eVal + "%" : "-") + '</td>';
    h += '<td class="' + rSt.cls + '">' + (rVal !== null ? rVal + "%" : "-") + '</td>';
    h += '<td class="' + cSt.cls + '"><strong>' + (cVal !== null ? cVal + "%" : "-") + '</strong></td>';
    h += "</tr>";
  });
  h += '</tbody></table></div></div>';
  return h;
}

function buildSector(sectorName, analysts, sectorConsolidado, analystData) {
  var h = '<div class="sec"><h2>üìä ' + sectorName + ' - Consolidado</h2>';
  h += buildKPICards(sectorConsolidado);
  h += '</div>';
  h += '<div class="sec"><h2>üë• ' + sectorName + ' - Por Analista</h2>';
  var hasData = false;
  analysts.forEach(function(a) {
    var d = analystData[a.login] || {};
    INDICADORES.forEach(function(ind) { if(d[ind] !== null && d[ind] !== undefined) hasData = true; });
  });
  if (!hasData) h += '<div class="note">‚ÑπÔ∏è Dados individuais n√£o encontrados nas planilhas carregadas. Verifique se a planilha "Anal√≠tico Indicadores TOA" foi carregada e cont√©m a coluna de LOGIN/MATR√çCULA.</div>';
  h += buildAnalystTable(analysts, analystData);
  h += '</div>';
  return h;
}

function buildMetas() {
  var h = '<div class="sec"><h2>üéØ Metas e Gloss√°rio dos Indicadores</h2>';
  h += '<div class="tbl-wrap"><table><thead><tr><th>#</th><th>Indicador</th><th>Meta</th><th>Dire√ß√£o</th><th>Descri√ß√£o</th><th>Per√≠odo</th></tr></thead><tbody>';
  var descs = {
    'DPA - Ocupa√ß√£o': '% de ocupa√ß√£o produtiva do colaborador',
    'Chat TOA': '% de intera√ß√£o dentro de 10 min',
    'ETIT por Evento RAL': '% tarefas direcionadas para o t√©cnico em at√© 30min (RAL)',
    'ETIT por Evento REC': '% tarefas direcionadas para o t√©cnico em at√© 30min (REC)',
    'ETIT Outage Sem Sinal (GPON)': 'Volume dentro do prazo (DP) / Volume total - GPON',
    'Log Outage Reprog. GPON': '% outages reprogramados sintoma sem sinal GPON',
    'ETIT Outage Res. Sem Sinal': 'Data/Hora do primeiro acionamento para o TOA - Sem Sinal',
    'ETIT Outage Res. Degrada√ß√£o': 'Data/Hora do primeiro acionamento para o TOA - Degrada√ß√£o',
    'Tempo Valid. Formul√°rio': 'Tempo de valida√ß√£o do formul√°rio ap√≥s conclus√£o',
    'Tarefas Canceladas': '% de tarefas canceladas sobre o total',
    'Fechamento TOA x SIR': 'Assertividade do fechamento TOA versus SIR'
  };
  var periodos = {
    'DPA - Ocupa√ß√£o': 'Madrugada', 'Chat TOA': 'Madrugada',
    'ETIT por Evento RAL': 'Madrugada', 'ETIT por Evento REC': 'Madrugada',
    'ETIT Outage Sem Sinal (GPON)': 'Todos', 'Log Outage Reprog. GPON': 'Todos',
    'ETIT Outage Res. Sem Sinal': 'Todos', 'ETIT Outage Res. Degrada√ß√£o': 'Todos',
    'Tempo Valid. Formul√°rio': 'Todos', 'Tarefas Canceladas': 'Todos',
    'Fechamento TOA x SIR': 'Todos'
  };
  var i = 1;
  INDICADORES.forEach(function(ind) {
    var m = METAS[ind];
    h += "<tr><td>" + i + "</td><td><strong>" + ind + "</strong></td>";
    h += '<td class="' + (m.dir==="up"?"gr":"rd") + '">' + m.meta + "%</td>";
    h += "<td>" + (m.dir==="up"?"‚Üë Quanto maior, melhor":"‚Üì Quanto menor, melhor") + "</td>";
    h += "<td>" + (descs[ind]||"") + "</td>";
    h += "<td>" + (periodos[ind]||"Todos") + "</td></tr>";
    i++;
  });
  h += '</tbody></table></div></div>';

  h += '<div class="sec"><h2>üë• Equipe Completa</h2>';
  h += '<div class="tbl-wrap"><table><thead><tr><th>Setor</th><th>Login</th><th>Nome Completo</th></tr></thead><tbody>';
  EMPRESARIAL.forEach(function(a) {
    h += '<tr><td><span class="badge badge-gr">EMP</span></td><td style="font-family:monospace">' + a.login + "</td><td>" + a.nome + "</td></tr>";
  });
  RESIDENCIAL.forEach(function(a) {
    h += '<tr><td><span class="badge badge-rd">RES</span></td><td style="font-family:monospace">' + a.login + "</td><td>" + a.nome + "</td></tr>";
  });
  h += '</tbody></table></div></div>';

  h += '<div class="sec"><h2>üì§ Instru√ß√µes de Upload</h2>';
  h += '<div class="note">';
  h += "<strong>Como usar este portal:</strong><br>";
  h += "1. Exporte as planilhas do Power BI / DPA Verint / Anal√≠tico TOA em formato .xlsx<br>";
  h += "2. Fa√ßa o upload de cada planilha no campo correspondente<br>";
  h += "3. Clique em Processar Dados para gerar o dashboard<br><br>";
  h += "<strong>Dicas:</strong><br>";
  h += "- As planilhas devem conter colunas de LOGIN/MATR√çCULA para identificar analistas<br>";
  h += "- Valores percentuais ser√£o identificados automaticamente<br>";
  h += "- A planilha Anal√≠tico TOA pode conter m√∫ltiplos indicadores em diferentes colunas ou abas<br>";
  h += "- N√£o √© obrigat√≥rio carregar todas as 7 planilhas - o dashboard mostrar√° os dados dispon√≠veis";
  h += '</div></div>';
  return h;
}

function showPanel(id, el) {
  document.querySelectorAll(".panel").forEach(function(p) { p.classList.remove("act"); });
  document.querySelectorAll(".tab").forEach(function(t) { t.classList.remove("act"); });
  document.getElementById(id).classList.add("act");
  el.classList.add("act");
}

// Initialize metas panel content (always visible)
document.getElementById("metas").innerHTML = buildMetas();
</script>
</body>
</html>
